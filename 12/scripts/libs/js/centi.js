(function(e,t){if(typeof define==="function"&&define.amd){define(["exports"],t)}else if(typeof exports==="object"){t(exports)}else{t(e.commonJsStrict={})}})(this,function(e){function t(e,t,n){this.obj=e;this.left=null;this.right=null;this.parent=n;this.dimension=t}function n(e,n,i){function o(e,n,r){var s=n%i.length,u,a;if(e.length===0){return null}if(e.length===1){return new t(e[0],s,r)}e.sort(function(e,t){return e[i[s]]-t[i[s]]});u=Math.floor(e.length/2);a=new t(e[u],s,r);a.left=o(e.slice(0,u),n+1,a);a.right=o(e.slice(u+1),n+1,a);return a}function u(e){function t(e){if(e.left){e.left.parent=e;t(e.left)}if(e.right){e.right.parent=e;t(e.right)}}s.root=e;t(s.root)}var s=this;if(!Array.isArray(e))u(e,n,i);else this.root=o(e,0,null);this.toJSON=function(e){if(!e)e=this.root;var n=new t(e.obj,e.dimension,null);if(e.left)n.left=s.toJSON(e.left);if(e.right)n.right=s.toJSON(e.right);return n};this.insert=function(e){function n(t,r){if(t===null){return r}var s=i[t.dimension];if(e[s]<t.obj[s]){return n(t.left,t)}else{return n(t.right,t)}}var r=n(this.root,null),s,o;if(r===null){this.root=new t(e,0,null);return}s=new t(e,(r.dimension+1)%i.length,r);o=i[r.dimension];if(e[o]<r.obj[o]){r.left=s}else{r.right=s}};this.remove=function(e){function n(t){if(t===null){return null}if(t.obj===e){return t}var r=i[t.dimension];if(e[r]<t.obj[r]){return n(t.left,t)}else{return n(t.right,t)}}function r(e){function u(e,t){var n,r,s,o,a;if(e===null){return null}n=i[t];if(e.dimension===t){if(e.right!==null){return u(e.right,t)}return e}r=e.obj[n];s=u(e.left,t);o=u(e.right,t);a=e;if(s!==null&&s.obj[n]>r){a=s}if(o!==null&&o.obj[n]>a.obj[n]){a=o}return a}function a(e,t){var n,r,s,o,u;if(e===null){return null}n=i[t];if(e.dimension===t){if(e.left!==null){return a(e.left,t)}return e}r=e.obj[n];s=a(e.left,t);o=a(e.right,t);u=e;if(s!==null&&s.obj[n]<r){u=s}if(o!==null&&o.obj[n]<u.obj[n]){u=o}return u}var t,n,o;if(e.left===null&&e.right===null){if(e.parent===null){s.root=null;return}o=i[e.parent.dimension];if(e.obj[o]<e.parent.obj[o]){e.parent.left=null}else{e.parent.right=null}return}if(e.left!==null){t=u(e.left,e.dimension)}else{t=a(e.right,e.dimension)}n=t.obj;r(t);e.obj=n}var t;t=n(s.root);if(t===null){return}r(t)};this.nearest=function(e,t,o){function l(r){function d(e,n){f.push([e,n]);if(f.size()>t){f.pop()}}var s,o=i[r.dimension],u=n(e,r.obj),a={},c,h,p;for(p=0;p<i.length;p+=1){if(p===r.dimension){a[i[p]]=e[i[p]]}else{a[i[p]]=r.obj[i[p]]}}c=n(a,r.obj);if(r.right===null&&r.left===null){if(f.size()<t||u<f.peek()[1]){d(r,u)}return}if(r.right===null){s=r.left}else if(r.left===null){s=r.right}else{if(e[o]<r.obj[o]){s=r.left}else{s=r.right}}l(s);if(f.size()<t||u<f.peek()[1]){d(r,u)}if(f.size()<t||Math.abs(c)<f.peek()[1]){if(s===r.left){h=r.right}else{h=r.left}if(h!==null){l(h)}}}var u,a,f;f=new r(function(e){return-e[1]});if(o){for(u=0;u<t;u+=1){f.push([null,o])}}l(s.root);a=[];for(u=0;u<t;u+=1){if(f.content[u][0]){a.push([f.content[u][0].obj,f.content[u][1]])}}return a};this.balanceFactor=function(){function e(t){if(t===null){return 0}return Math.max(e(t.left),e(t.right))+1}function t(e){if(e===null){return 0}return t(e.left)+t(e.right)+1}return e(s.root)/(Math.log(t(s.root))/Math.log(2))}}function r(e){this.content=[];this.scoreFunction=e}r.prototype={push:function(e){this.content.push(e);this.bubbleUp(this.content.length-1)},pop:function(){var e=this.content[0];var t=this.content.pop();if(this.content.length>0){this.content[0]=t;this.sinkDown(0)}return e},peek:function(){return this.content[0]},remove:function(e){var t=this.content.length;for(var n=0;n<t;n++){if(this.content[n]==e){var r=this.content.pop();if(n!=t-1){this.content[n]=r;if(this.scoreFunction(r)<this.scoreFunction(e))this.bubbleUp(n);else this.sinkDown(n)}return}}throw new Error("Node not found.")},size:function(){return this.content.length},bubbleUp:function(e){var t=this.content[e];while(e>0){var n=Math.floor((e+1)/2)-1,r=this.content[n];if(this.scoreFunction(t)<this.scoreFunction(r)){this.content[n]=t;this.content[e]=r;e=n}else{break}}},sinkDown:function(e){var t=this.content.length,n=this.content[e],r=this.scoreFunction(n);while(true){var i=(e+1)*2,s=i-1;var o=null;if(s<t){var u=this.content[s],a=this.scoreFunction(u);if(a<r)o=s}if(i<t){var f=this.content[i],l=this.scoreFunction(f);if(l<(o==null?r:a)){o=i}}if(o!=null){this.content[e]=this.content[o];this.content[o]=n;e=o}else{break}}}};this.kdTree=n;e.kdTree=n;e.BinaryHeap=r})
!function(a){function c(a,b,c){this.x=a,this.y=b,this.z=c}function l(a){return a*a*a*(a*(6*a-15)+10)}function m(a,b,c){return(1-c)*a+c*b}var b=a.perlin={};c.prototype.dot2=function(a,b){return this.x*a+this.y*b},c.prototype.dot3=function(a,b,c){return this.x*a+this.y*b+this.z*c};var d=[new c(1,1,0),new c(-1,1,0),new c(1,-1,0),new c(-1,-1,0),new c(1,0,1),new c(-1,0,1),new c(1,0,-1),new c(-1,0,-1),new c(0,1,1),new c(0,-1,1),new c(0,1,-1),new c(0,-1,-1)],e=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],f=new Array(512),g=new Array(512);b.seed=function(a){a>0&&1>a&&(a*=65536),a=Math.floor(a),256>a&&(a|=a<<8);for(var b=0;256>b;b++){var c;c=1&b?e[b]^255&a:e[b]^255&a>>8,f[b]=f[b+256]=c,g[b]=g[b+256]=d[c%12]}},b.seed(0);var h=.5*(Math.sqrt(3)-1),i=(3-Math.sqrt(3))/6,j=1/3,k=1/6;b.simplex2=function(a,b){var c,d,e,p,q,j=(a+b)*h,k=Math.floor(a+j),l=Math.floor(b+j),m=(k+l)*i,n=a-k+m,o=b-l+m;n>o?(p=1,q=0):(p=0,q=1);var r=n-p+i,s=o-q+i,t=n-1+2*i,u=o-1+2*i;k&=255,l&=255;var v=g[k+f[l]],w=g[k+p+f[l+q]],x=g[k+1+f[l+1]],y=.5-n*n-o*o;0>y?c=0:(y*=y,c=y*y*v.dot2(n,o));var z=.5-r*r-s*s;0>z?d=0:(z*=z,d=z*z*w.dot2(r,s));var A=.5-t*t-u*u;return 0>A?e=0:(A*=A,e=A*A*x.dot2(t,u)),70*(c+d+e)},b.simplex3=function(a,b,c){var d,e,h,i,t,u,v,w,x,y,l=(a+b+c)*j,m=Math.floor(a+l),n=Math.floor(b+l),o=Math.floor(c+l),p=(m+n+o)*k,q=a-m+p,r=b-n+p,s=c-o+p;q>=r?r>=s?(t=1,u=0,v=0,w=1,x=1,y=0):q>=s?(t=1,u=0,v=0,w=1,x=0,y=1):(t=0,u=0,v=1,w=1,x=0,y=1):s>r?(t=0,u=0,v=1,w=0,x=1,y=1):s>q?(t=0,u=1,v=0,w=0,x=1,y=1):(t=0,u=1,v=0,w=1,x=1,y=0);var z=q-t+k,A=r-u+k,B=s-v+k,C=q-w+2*k,D=r-x+2*k,E=s-y+2*k,F=q-1+3*k,G=r-1+3*k,H=s-1+3*k;m&=255,n&=255,o&=255;var I=g[m+f[n+f[o]]],J=g[m+t+f[n+u+f[o+v]]],K=g[m+w+f[n+x+f[o+y]]],L=g[m+1+f[n+1+f[o+1]]],M=.5-q*q-r*r-s*s;0>M?d=0:(M*=M,d=M*M*I.dot3(q,r,s));var N=.5-z*z-A*A-B*B;0>N?e=0:(N*=N,e=N*N*J.dot3(z,A,B));var O=.5-C*C-D*D-E*E;0>O?h=0:(O*=O,h=O*O*K.dot3(C,D,E));var P=.5-F*F-G*G-H*H;return 0>P?i=0:(P*=P,i=P*P*L.dot3(F,G,H)),32*(d+e+h+i)},b.perlin2=function(a,b){var c=Math.floor(a),d=Math.floor(b);a-=c,b-=d,c=255&c,d=255&d;var e=g[c+f[d]].dot2(a,b),h=g[c+f[d+1]].dot2(a,b-1),i=g[c+1+f[d]].dot2(a-1,b),j=g[c+1+f[d+1]].dot2(a-1,b-1),k=l(a);return m(m(e,i,k),m(h,j,k),l(b))},b.perlin3=function(a,b,c){var d=Math.floor(a),e=Math.floor(b),h=Math.floor(c);a-=d,b-=e,c-=h,d=255&d,e=255&e,h=255&h;var i=g[d+f[e+f[h]]].dot3(a,b,c),j=g[d+f[e+f[h+1]]].dot3(a,b,c-1),k=g[d+f[e+1+f[h]]].dot3(a,b-1,c),n=g[d+f[e+1+f[h+1]]].dot3(a,b-1,c-1),o=g[d+1+f[e+f[h]]].dot3(a-1,b,c),p=g[d+1+f[e+f[h+1]]].dot3(a-1,b,c-1),q=g[d+1+f[e+1+f[h]]].dot3(a-1,b-1,c),r=g[d+1+f[e+1+f[h+1]]].dot3(a-1,b-1,c-1),s=l(a),t=l(b),u=l(c);return m(m(m(i,o,s),m(j,p,s),u),m(m(k,q,s),m(n,r,s),u),t)}}(this);
Date.now===undefined&&(Date.now=function(){return(new Date).valueOf()});var TWEEN=TWEEN||function(){var e=[];return{REVISION:"14",getAll:function(){return e},removeAll:function(){e=[]},add:function(t){e.push(t)},remove:function(t){var n=e.indexOf(t);n!==-1&&e.splice(n,1)},update:function(t){if(e.length===0)return!1;var n=0;t=t!==undefined?t:typeof window!="undefined"&&window.performance!==undefined&&window.performance.now!==undefined?window.performance.now():Date.now();while(n<e.length)e[n].update(t)?n++:e.splice(n,1);return!0}}}();TWEEN.Tween=function(e){var t=e,n={},r={},i={},s=1e3,o=0,u=!1,a=!1,f=!1,l=0,c=null,h=TWEEN.Easing.Linear.None,p=TWEEN.Interpolation.Linear,d=[],v=null,m=!1,g=null,y=null,b=null;for(var w in e)n[w]=parseFloat(e[w],10);this.to=function(e,t){return t!==undefined&&(s=t),r=e,this},this.start=function(e){TWEEN.add(this),a=!0,m=!1,c=e!==undefined?e:typeof window!="undefined"&&window.performance!==undefined&&window.performance.now!==undefined?window.performance.now():Date.now(),c+=l;for(var s in r){if(r[s]instanceof Array){if(r[s].length===0)continue;r[s]=[t[s]].concat(r[s])}n[s]=t[s],n[s]instanceof Array==0&&(n[s]*=1),i[s]=n[s]||0}return this},this.stop=function(){return a?(TWEEN.remove(this),a=!1,b!==null&&b.call(t),this.stopChainedTweens(),this):this},this.stopChainedTweens=function(){for(var e=0,t=d.length;e<t;e++)d[e].stop()},this.delay=function(e){return l=e,this},this.repeat=function(e){return o=e,this},this.yoyo=function(e){return u=e,this},this.easing=function(e){return h=e,this},this.interpolation=function(e){return p=e,this},this.chain=function(){return d=arguments,this},this.onStart=function(e){return v=e,this},this.onUpdate=function(e){return g=e,this},this.onComplete=function(e){return y=e,this},this.onStop=function(e){return b=e,this},this.update=function(e){var a;if(e<c)return!0;m===!1&&(v!==null&&v.call(t),m=!0);var b=(e-c)/s;b=b>1?1:b;var w=h(b);for(a in r){var E=n[a]||0,S=r[a];S instanceof Array?t[a]=p(S,w):(typeof S=="string"&&(S=E+parseFloat(S,10)),typeof S=="number"&&(t[a]=E+(S-E)*w))}g!==null&&g.call(t,w);if(b==1){if(o>0){isFinite(o)&&o--;for(a in i){typeof r[a]=="string"&&(i[a]=i[a]+parseFloat(r[a],10));if(u){var x=i[a];i[a]=r[a],r[a]=x}n[a]=i[a]}return u&&(f=!f),c=e+l,!0}y!==null&&y.call(t);for(var T=0,N=d.length;T<N;T++)d[T].start(e);return!1}return!0}},TWEEN.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-0.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-0.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return e===0?0:Math.pow(1024,e-1)},Out:function(e){return e===1?1:1-Math.pow(2,-10*e)},InOut:function(e){return e===0?0:e===1?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(-Math.pow(2,-10*(e-1))+2)}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-0.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){var t,n=.1,r=.4;return e===0?0:e===1?1:(!n||n<1?(n=1,t=r/4):t=r*Math.asin(1/n)/(2*Math.PI),-(n*Math.pow(2,10*(e-=1))*Math.sin((e-t)*2*Math.PI/r)))},Out:function(e){var t,n=.1,r=.4;return e===0?0:e===1?1:(!n||n<1?(n=1,t=r/4):t=r*Math.asin(1/n)/(2*Math.PI),n*Math.pow(2,-10*e)*Math.sin((e-t)*2*Math.PI/r)+1)},InOut:function(e){var t,n=.1,r=.4;return e===0?0:e===1?1:(!n||n<1?(n=1,t=r/4):t=r*Math.asin(1/n)/(2*Math.PI),(e*=2)<1?-0.5*n*Math.pow(2,10*(e-=1))*Math.sin((e-t)*2*Math.PI/r):n*Math.pow(2,-10*(e-=1))*Math.sin((e-t)*2*Math.PI/r)*.5+1)}},Back:{In:function(e){var t=1.70158;return e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?.5*e*e*((t+1)*e-t):.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-TWEEN.Easing.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?TWEEN.Easing.Bounce.In(e*2)*.5:TWEEN.Easing.Bounce.Out(e*2-1)*.5+.5}}},TWEEN.Interpolation={Linear:function(e,t){var n=e.length-1,r=n*t,i=Math.floor(r),s=TWEEN.Interpolation.Utils.Linear;return t<0?s(e[0],e[1],r):t>1?s(e[n],e[n-1],n-r):s(e[i],e[i+1>n?n:i+1],r-i)},Bezier:function(e,t){var n=0,r=e.length-1,i=Math.pow,s=TWEEN.Interpolation.Utils.Bernstein,o;for(o=0;o<=r;o++)n+=i(1-t,r-o)*i(t,o)*e[o]*s(r,o);return n},CatmullRom:function(e,t){var n=e.length-1,r=n*t,i=Math.floor(r),s=TWEEN.Interpolation.Utils.CatmullRom;return e[0]===e[n]?(t<0&&(i=Math.floor(r=n*(1+t))),s(e[(i-1+n)%n],e[i],e[(i+1)%n],e[(i+2)%n],r-i)):t<0?e[0]-(s(e[0],e[0],e[1],e[1],-r)-e[0]):t>1?e[n]-(s(e[n],e[n],e[n-1],e[n-1],r-n)-e[n]):s(e[i?i-1:0],e[i],e[n<i+1?n:i+1],e[n<i+2?n:i+2],r-i)},Utils:{Linear:function(e,t,n){return(t-e)*n+e},Bernstein:function(e,t){var n=TWEEN.Interpolation.Utils.Factorial;return n(e)/n(t)/n(e-t)},Factorial:function(){var e=[1];return function(t){var n=1,r;if(e[t])return e[t];for(r=t;r>1;r--)n*=r;return e[t]=n}}(),CatmullRom:function(e,t,n,r,i){var s=(n-e)*.5,o=(r-t)*.5,u=i*i,a=i*u;return(2*t-2*n+s+o)*a+(-3*t+3*n-2*s-o)*u+s*i+t}}},typeof module!="undefined"&&module.exports&&(module.exports=TWEEN)
!function(a,b){"function"==typeof define&&define.amd?define(b):"object"==typeof exports?module.exports=b():a.glitch=b()}(this,function(){function p(d,e,f){if(y(d)&&z(e,"parameters","object")&&z(f,"callback","function")){for(h=x(e),q(a,d),q(b,d),i=s(d,h.quality),j=u(i),k=t(j),n=0,o=h.iterations;o>n;n++)r(j,k,h.seed,h.amount,n,h.iterations);l=new Image,l.onload=function(){c.drawImage(l,0,0),m=c.getImageData(0,0,d.width,d.height),f(m)},l.src=v(j)}}function q(a,b){a.width!==b.width&&(a.width=b.width),a.height!==b.height&&(a.height=b.height)}function r(a,b,c,d,e,f){var g=a.length-b-4,h=parseInt(g/f*e,10),i=parseInt(g/f*(e+1),10),j=i-h,k=parseInt(h+j*c,10);k>g&&(k=g);var l=Math.floor(b+k);a[l]=Math.floor(256*d)}function s(a,c){var e="number"==typeof c&&1>c&&c>0?c:.1;return d.putImageData(a,0,0),b.toDataURL("image/jpeg",e)}function t(a){var b=417;for(n=0,o=a.length;o>n;n++)if(255===a[n]&&218===a[n+1]){b=n+2;break}return b}function u(a){var c,d,e,b=[];for(n=23,o=a.length;o>n;n++){switch(d=g[a.charAt(n)],c=(n-23)%4){case 1:b.push(e<<2|d>>4);break;case 2:b.push((15&e)<<4|d>>2);break;case 3:b.push((3&e)<<6|d)}e=d}return b}function v(a){var c,d,e,b=["data:image/jpeg;base64,"];for(n=0,o=a.length;o>n;n++){switch(d=a[n],c=n%3){case 0:b.push(f[d>>2]);break;case 1:b.push(f[(3&e)<<4|d>>4]);break;case 2:b.push(f[(15&e)<<2|d>>6]),b.push(f[63&d])}e=d}return 0===c?(b.push(f[(3&e)<<4]),b.push("==")):1===c&&(b.push(f[(15&e)<<2]),b.push("=")),b.join("")}function x(a){return{seed:(a.seed||0)/100,quality:(a.quality||0)/100,amount:(a.amount||0)/100,iterations:a.iterations||0}}function y(a){return z(a,"image_data","object")&&z(a.width,"image_data.width","number")&&z(a.height,"image_data.height","number")&&z(a.data,"image_data.data","object")&&z(a.data.length,"image_data.data.length","number")&&A(a.data.length,"image_data.data.length",B,"> 0")?!0:!1}function z(a,b,c){return typeof a===c?!0:(C(a,"typeof "+b,'"'+c+'"','"'+typeof a+'"'),!1)}function A(a,b,c,d){return c(a)===!0?!0:(C(a,b,d,"not"),void 0)}function B(a){return a>0}function C(a,b,c,d){throw new Error("glitch(): Expected "+b+" to be "+c+", but it was "+d+".")}var h,i,j,k,l,m,n,o,a=document.createElement("canvas"),b=document.createElement("canvas"),c=a.getContext("2d"),d=b.getContext("2d"),e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",f=e.split(""),g={};return f.forEach(function(a,b){g[a]=b}),p});
!function(_root){_root.requestAnimationFrame||(_root.requestAnimationFrame=function(){return _root.webkitRequestAnimationFrame||_root.mozRequestAnimationFrame||_root.oRequestAnimationFrame||_root.msRequestAnimationFrame||function(a,b){_root.setTimeout(a,1e3/60)}}()),_root.cancelAnimationFrame||(_root.cancelAnimationFrame=_root.cancelAnimationFrame||_root.mozCancelAnimationFrame||_root.webkitCancelAnimationFrame||_root.msCancelAnimationFrame),_root.XMLHttpRequest||(_root.XMLHttpRequest=function(){try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(a){}throw new Error("This browser does not support XMLHttpRequest.")}),_root.evalInContext||(_root.evalInContext=function(source,context){function values(){var a=[];for(var b in context)context.hasOwnProperty(b)&&a.push(context[b]);return a}source="(function("+Object.keys(context).join(", ")+") {"+source+"})";var compiled=eval(source);return compiled.apply(context,values())}),_root.get_url_vars||(_root.get_url_vars=function(){for(var b,a=new Object,c=_root.location.href.slice(_root.location.href.indexOf("?")+1).split("&"),d=0;d<c.length;d++)b=c[d].split("="),2==b.length&&(a[decodeURIComponent(b[0])]=decodeURIComponent(b[1]));return a}),_root.checkFileReaderApi||(_root.checkFileReaderApi=function(){return _root.File&&_root.FileReader&&_root.FileList&&_root.Blob}),_root.checkFileWriterApi||(_root.checkFileWriterApi=function(){return _root.File&&_root.saveAs&&_root.FileList&&_root.Blob}),_root.audioContext||(_root.audioContext=null),_root.audioContextClass||(_root.audioContextClass=_root.AudioContext||_root.webkitAudioContext||_root.mozAudioContext||_root.oAudioContext||_root.msAudioContext),_root.getAudioContext||(_root.getAudioContext=function(){return _root.audioContext?_root.audioContext:!_root.audioContext&&_root.audioContextClass?_root.audioContext=new _root.audioContextClass:null}),_root.audioContext||(_root.audioContext=null),_root.getAudioAnalyser||(_root.getAudioAnalyser=function(){return _root.audioAnalyser||(_root.audioAnalyser=_root.getAudioContext().createAnalyser())}),Array.prototype.forEach||(Array.prototype.forEach=function(a,b){for(var c=0;c<this.length;c++)a.call(b||null,this[c],c,this)}),Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),_root.WindowResizeHelper||(_root.WindowResizeHelper=function(a){this.func=a,this.timer=0},_root.WindowResizeHelper.prototype.dispose=function(){this.func=null,this.disable()},_root.WindowResizeHelper.prototype.enable=function(){_root.addEventListener?_root.addEventListener("resize",this.onResize.bind(this),!1):_root.attachEvent?_root.attachEvent("onresize",this.onResize.bind(this)):_root.onresize},_root.WindowResizeHelper.prototype.disable=function(){_root.removevEventListener?_root.removevEventListener("resize",this.onResize.bind(this),!1):_root.detachEvent?_root.detachEvent("onresize",this.onResize.bind(this)):_root.onresize},_root.WindowResizeHelper.prototype.onResize=function(a){this.func&&(clearTimeout(this.timer),this.timer=setTimeout(this.func,500,a))})}(window);

var MATH_PROPS=["E","LN2","LN10","LOG2E","LOG10E","PI","PI2","HALF_PI","SQRT1_2","SQRT2"],MATHS=["abs","acos","asin","atan","atan2","ceil","cos","exp","floor","imul","log","max","min","pow","random","round","sin","sqrt","tan"],CTX_FUNCS=Object.getOwnPropertyNames(CanvasRenderingContext2D.prototype);Math.PI2=2*Math.PI,Math.HALF_PI=Math.PI/2;var CT_PROPS,Centi=function(a,b){this.ver="0.4.9e",this.name=a?a:"ct",this.editor=b?b:null,this.canvas=null,this.ctx=null,this.tempCanvas=null,this.tempCtx=null,this.dsp={enable:!1,context:null,analyser:null,processor:null},this.sampleRate=44100,this.fft=new Uint8Array(1024),this.waveUint=new Uint8Array(2048),this.wave=new Float32Array(2048),this.GOLD=(1+Math.sqrt(5))/2,this.x=0,this.y=0,this.c=0,this.time=0,this.w=720,this.h=360,this.sizeW=this.w,this.sizeH=this.h,this.cx=this.w/2,this.cy=this.h/2,this.mx=0,this.my=0,this.down=!1,this.tempo={bpm:120,sec:.5,preSec:0,divide:4},this.beat=0,this.initSec=this.now(),this.bgcolor={r:0,g:0,b:0,a:255},this.drawcolor={r:0,g:0,b:0,a:255},this.bFill=!0,this.gradient=null,this.kdtree,this.centiCode,this.setupMethod="",this.drawMethod="",this.beatMethod="",this.dspMethod="",this.setupFunc=null,this.drawFunc=null,this.beatFunc=null,this.dspFunc=null,this.mouseMoveMethod="",this.mouseDownMethod="",this.mouseUpMethod="",this.mouseMove=null,this.mouseDown=null,this.mouseUp=null,this.toGifFunc=null,this.b3d=!1,this.pluginInstances=[];for(var c=0;c<MATHS.length;c++)this[MATHS[c]]=Math[MATHS[c]];for(var c=0;c<MATH_PROPS.length;c++)this[MATH_PROPS[c]]=Math[MATH_PROPS[c]];this.ease=TWEEN.Easing,this.Linear=TWEEN.Easing.Linear.None,this.eases=[this.Linear];for(var d=["Quad","Cubic","Quart","Quint","Sine","Expo","Circ","Elastic","Back","Bounce"],e=["Quadratic","Cubic","Quartic","Quintic","Sinusoidal","Exponential","Circular","Elastic","Back","Bounce"],c=0;c<d.length;c++)this[d[c]+"In"]=TWEEN.Easing[e[c]].In,this[d[c]+"Out"]=TWEEN.Easing[e[c]].Out,this[d[c]+"InOut"]=TWEEN.Easing[e[c]].InOut,this.eases.push(this[d[c]+"In"],this[d[c]+"Out"],this[d[c]+"InOut"]);if(!CT_PROPS){var f=[];for(var g in this)-1==CT_FUNCS.indexOf(g)&&f.push(g);CT_PROPS=f}};Centi.plugins=[],Centi.prototype.destroy=function(){this.dsp.processor&&(this.dsp.processor.disconnect(),this.dsp.processor.onaudioprocess=null,this.dsp.processor=null),this.dsp.analyser&&(this.dsp.analyser.disconnect(),this.dsp.analyser=null),this.dsp.context&&this.dsp.context.distination.disconnect(),this.dsp.context=null,this.canvas=null,this.ctx=null,this.tempCanvas=null,this.tempCtx=null,this.dsp=null,this.tempo=null,this.toGifFunc=null,this.setupFunc=null,this.drawFunc=null,this.beatFunc=null,this.dspFunc=null,this.mouseMove=null,this.mouseDown=null,this.mouseUp=null,this.fft=null,this.wave=null,this.b3d=!1,this.pluginInstances=null},Centi.prototype.init=function(a,b){if(this.canvas=a,this.tempCanvas=document.createElement("canvas"),this.tempCtx=this.tempCanvas.getContext("2d"),this.initSec=this.now(),this.time=0,b){this.dsp.enable=!0,this.dsp.context=b,this.dsp.context.createScriptProcessor=this.dsp.context.createScriptProcessor||this.dsp.context.createJavaScriptNode;var c=function(){return/(Win(dows )?NT 6\.2)/.test(navigator.userAgent)?1024:/(Win(dows )?NT 6\.1)/.test(navigator.userAgent)?1024:/(Win(dows )?NT 6\.0)/.test(navigator.userAgent)?2048:/Win(dows )?(NT 5\.1|XP)/.test(navigator.userAgent)?4096:/Mac|PPC/.test(navigator.userAgent)?4096:/Linux/.test(navigator.userAgent)?8192:/iPhone|iPad|iPod/.test(navigator.userAgent)?2048:16384};this.dsp.analyser=this.dsp.context.createAnalyser(),this.dsp.analyser.connect(this.dsp.context.destination),this.sampleRate=this.dsp.context.sampleRate;var d=1/this.dsp.context.sampleRate,e=this.dsp.context.createScriptProcessor(c(),0,2);this.dsp.processor=e;var f=this.dsp.context.createBufferSource();f.connect(e),e.connect(this.dsp.analyser);var g=this;e.onaudioprocess=function(a){g.updateBeat();for(var b=a.outputBuffer.getChannelData(0),c=a.outputBuffer.getChannelData(1),e="number"==typeof g.doDsp(),f=0;f<this.bufferSize;f++){g.time;var i=g.doDsp();e?(b[f]=i,c[f]=i):2==i.length&&(b[f]=i[0],c[f]=i[1]),g.time+=d}}}else this.dsp.enable=!1;for(var h=0;h<Centi.plugins.length;h++){var i=new Centi.plugins[h](this);this.pluginInstances.push(i)}return a.getContext?!0:!1},Centi.prototype.doDsp=function(){return this.dspFunc?this.dspFunc():0},Centi.prototype.feedback=function(a){function d(a){var b="";if(f("Array",a)){if(b="[",a.length>0){for(var c=0;c<a.length;c++)b+=d(a[c])+",";b=b.slice(0,-1)}b+="]"}else f("Number",a)?b=a.toString():f("Object",a)?b=e(a):f("Boolean",a)&&(b=a?"1":"0");return b}function e(a){var b="{";for(var c in a)b+=c+":"+a[c]+",";return b.length>1&&(b=b.slice(0,-1)),b+="}"}function f(a,b){var c=Object.prototype.toString.call(b).slice(8,-1);return void 0!==b&&null!==b&&c===a}function g(a,b,c){var d=a;if(d.length>0){var e=0;if(e=d.indexOf(b+"="),-1==e&&(e=d.indexOf(b+" =")),e>-1)for(var f=e,g=0,h=g;e<d.length;){var i=d.charAt(e);if("("==i&&g++,")"==i&&g--,1==h&&0==g){d=d.slice(0,f+b.length)+"=("+c+")"+d.slice(e+1);break}h=g,e++}}return d}if(this.editor){var b=d(a);for(var c in this)if(-1==CT_PROPS.indexOf(c)&&this[c]===a){this.centiCode=g(this.centiCode,c,b),this.editor.value=this.centiCode;break}}},Centi.prototype.parse=function(a){function u(a,b){a=a.replace(o,b+"."+"$1"+"$2"),a=a.replace(n,"$2"),a=a.replace(i,"for("),a=a.replace(j,"while("),a=a.replace(k,"if("),a=a.replace(l,"else{"),a=a.replace(m,"else if("),a=a.replace(p,"function("),a=a.replace(q,"arguments[$2]"),a=a.replace(r,"return ("),a=a.replace(s,".");for(var c=0;c<t.length;c++){var d=new RegExp(b+"."+t[c].prefix+".","g");a=a.replace(d,t[c].prefix+"."),t[c].shortPrefix&&(d=new RegExp(b+"."+t[c].shortPrefix+".","g"),a=a.replace(d,t[c].prefix+"."))}for(var e=["Infinity","NaN","undefined","null","this","true","false"],c=0;c<e.length;c++)a=a.replace(new RegExp(b+"."+e[c],"g"),e[c]);for(var f=["MAX_VALUE","MIN_VALUE","POSITIVE_INFINITY","NEGATIVE_INFINITY"],c=0;c<f.length;c++)a=a.replace(new RegExp(b+"."+f[c],"g"),"Number."+f[c]);var g=new RegExp(b+".([A-Za-z0-9_]+)(:)([A-Za-z0-9_.()]+)(,)","g");a=a.replace(g,"$1:$3,");var h=new RegExp(b+".([A-Za-z0-9_]+)(:)([A-Za-z0-9_.()]+)(})","g");return a=a.replace(h,"$1:$3}")}this.centiCode=a,a=a.replace(/\s/g,""),a=a.replace(/\b/g,""),a=a.replace(/(\))([A-Za-z0-9_\}])/g,");$2"),a=a.replace(/(for\()([A-Za-z_\-\.\(\)]+)(\,)([A-Za-z0-9_\-\.\(\)]+)(\,)([A-Za-z0-9_\-\.\(\)\*\+\/]+)(\))/g,"for($2=$4;$2<$6;$2++)");var b=this.getInnerExpression(a.slice(a.indexOf("frame(){"))),c=this.getInnerExpression(a.slice(a.indexOf("beat(){"))),d=this.getInnerExpression(a.slice(a.indexOf("dsp(){"))),e=this.getInnerExpression(a.slice(a.indexOf("move(){"))),f=this.getInnerExpression(a.slice(a.indexOf("down(){"))),g=this.getInnerExpression(a.slice(a.indexOf("up(){"))),h=a.replace("frame(){"+b+"}","");h=h.replace("beat(){"+c+"}",""),h=h.replace("dsp(){"+d+"}",""),h=h.replace("move(){"+e+"}",""),h=h.replace("down(){"+f+"}",""),h=h.replace("up(){"+g+"}",""),/c3d\(\)/.test(h)?this.c3d():this.c2d();var i=new RegExp(this.name+".for\\(","g"),j=new RegExp(this.name+".while\\(","g"),k=new RegExp(this.name+".if\\(","g"),l=new RegExp(this.name+".else\\{","g"),m=new RegExp(this.name+".elseIf\\(","g"),n=new RegExp("("+this.name+").([0-9.]+)","g"),o=/([A-Za-z0-9_]+)([\.\!\~\|\%\&\:\(\)\{\}\;\=\+\-\<\>\*\/\[\]\,\^])/g,p=new RegExp(this.name+".func\\(","g"),q=/(\$)([0-9]+)/g,r=new RegExp(this.name+".return\\(","g"),s=new RegExp("\\."+this.name+"\\.","g"),t=this.pluginInstances;return h=u(h,this.name),h=this.modFunction(h),b=u(b,this.name),b=this.modFunction(b),c=u(c,this.name),c=this.modFunction(c),d=u(d,this.name),d=this.modFunction(d),e=u(e,this.name),e=this.modFunction(e),f=u(f,this.name),f=this.modFunction(f),g=u(g,this.name),g=this.modFunction(g),this.drawMethod=b,this.beatMethod=c,this.dspMethod=d,this.mouseMoveMethod=e,this.mouseDownMethod=f,this.mouseUpMethod=g,this.drawFunc=""!=this.drawMethod?evalInContext("return (function(){"+this.drawMethod+"});",this):null,this.beatFunc=""!=this.beatMethod?evalInContext("return (function(){"+this.beatMethod+"});",this):null,this.dspFunc=""!=this.dspMethod?evalInContext("return (function(){"+this.dspMethod+"});",this):null,this.mouseMove=""!=this.mouseMoveMethod?evalInContext("return (function(){"+this.mouseMoveMethod+"});",this):null,this.mouseDown=""!=this.mouseDownMethod?evalInContext("return (function(){"+this.mouseDownMethod+"});",this):null,this.mouseUp=""!=this.mouseUpMethod?evalInContext("return (function(){"+this.mouseUpMethod+"});",this):null,this.setupMethod=h,this.setupFunc=""!=this.setupMethod?evalInContext("return (function(){"+this.setupMethod+"});",this):null,!0},Centi.prototype.start=function(){for(var a=0;a<this.pluginInstances.length;a++)this.pluginInstances[a].preSetup();0==this.b3d&&(this.ctx=this.canvas.getContext("2d"),this.clear()),this.reset(),this.bg(0),this.bpm(120,4),this.setupFunc&&this.setupFunc();for(var a=0;a<this.pluginInstances.length;a++)this.pluginInstances[a].postSetup();this.col(255),this.canvas.addEventListener&&(this.canvas.removeEventListener("mousemove",this),this.canvas.removeEventListener("mousedown",this),this.canvas.removeEventListener("mouseup",this),this.canvas.addEventListener("mousemove",this,!1),this.canvas.addEventListener("mousedown",this,!1),this.canvas.addEventListener("mouseup",this,!1)),this.canvas.addEventListener&&document.addEventListener&&(this.canvas.removeEventListener("touchstart",this),this.canvas.removeEventListener("touchmove",this),document.removeEventListener("touchend",this),document.removeEventListener("touchcancel",this),this.canvas.addEventListener("touchstart",this,!1),this.canvas.addEventListener("touchmove",this,!1),document.addEventListener("touchend",this,!1),document.addEventListener("touchcancel",this,!1))},Centi.prototype.handleEvent=function(a){function c(a){var c=b.canvas.getBoundingClientRect();b.mx=a.clientX-c.left,b.my=a.clientY-c.top}function d(a){b.mx=a.layerX,b.my=a.layerY}var b=this;switch(a.type){case"mousedown":c(a),this.down=!0,this.mouseDown&&this.mouseDown(a);break;case"mousemove":c(a),this.mouseMove&&this.mouseMove(a);break;case"mouseup":c(a),this.down=!1,this.mouseUp&&this.mouseUp(a);break;case"touchstart":d(a),this.down=!0,this.mouseDown&&this.mouseDown(a);break;case"touchmove":d(a),this.mouseMove&&this.mouseMove(a),a.preventDefault();break;case"touchend":case"touchcancel":d(a),this.down=!1,this.mouseUp&&this.mouseUp(a)}},Centi.prototype.modFunction=function(a){var b=(a.match(/function/g)||[]).length;if(b>0){var c=a,d=0;d=c.indexOf("function",d)+7;for(var e=0,f=e;d<c.length;){var g=c.charAt(d);if("{"==g&&e++,"}"==g&&e--,1==f&&0==e)if(c=c.slice(0,d+1)+";"+c.slice(d+1),b--,b>0)d=c.indexOf("function",d)+7;else if(0==b)break;f=e,d++}a=c,a=a.replace(";};);",";});")}return a},Centi.prototype.getInnerExpression=function(a){var b=a,c=0,d=0;if(c=d=b.indexOf("{",d),-1==c)return"";for(var e=0,f=e;d<b.length;){var g=b.charAt(d);if("{"==g&&e++,"}"==g&&e--,1==f&&0==e){b=b.slice(c+1,d);break}f=e,d++}return 0==e?b:""},Centi.prototype.update=function(){for(var a=0;a<this.pluginInstances.length;a++)this.pluginInstances[a].preUpdate();if(0==this.dsp.enable)this.time=this.now()-this.initSec,this.updateBeat();else{this.dsp.analyser.getByteFrequencyData(this.fft),this.dsp.analyser.getByteTimeDomainData(this.waveUint);for(var a=0;a<this.waveUint.length;a++)this.wave[a]=2*(this.waveUint[a]/255-.5)}TWEEN.update(),this.push(),this.drawFunc&&this.drawFunc(),this.pop();for(var a=0;a<this.pluginInstances.length;a++)this.pluginInstances[a].postUpdate();this.c++,null!=this.toGifFunc&&this.toGifFunc(this.ctx)},Centi.prototype.updateBeat=function(){this.time-this.tempo.preSec>=this.tempo.sec&&(this.beatFunc&&this.beatFunc(),this.tempo.preSec=this.time,this.beat++)},Centi.prototype.reset=function(){this.c=0,this.initSec=this.now(),this.time=0,this.bFill=!0,this.lw(1),this.lj(0),this.lc(0),this.bm(0),this.bg(0),this.col(255)},Centi.prototype.c2d=function(){this.b3d=!1},Centi.prototype.c3d=function(){this.b3d=!0},Centi.prototype.bg=function(){if(null!=this.ctx){var a=arguments.length;1==a?(this.bgcolor.r=parseInt(arguments[0]),this.bgcolor.g=parseInt(arguments[0]),this.bgcolor.b=parseInt(arguments[0]),this.bgcolor.a=255):2==a?(this.bgcolor.r=parseInt(arguments[0]),this.bgcolor.g=parseInt(arguments[0]),this.bgcolor.b=parseInt(arguments[0]),this.bgcolor.a=parseInt(arguments[1])):3==a?(this.bgcolor.r=parseInt(arguments[0]),this.bgcolor.g=parseInt(arguments[1]),this.bgcolor.b=parseInt(arguments[2]),this.bgcolor.a=255):4==a&&(this.bgcolor.r=parseInt(arguments[0]),this.bgcolor.g=parseInt(arguments[1]),this.bgcolor.b=parseInt(arguments[2]),this.bgcolor.a=parseInt(arguments[3])),this.clear()}},Centi.prototype.lg=function(){console.log(arguments)},Centi.prototype.log=function(){console.log(arguments)},Centi.prototype.sz=function(a,b){this.size(a,b)},Centi.prototype.size=function(a,b){this.sizeW=a,this.sizeH=b;var c,d;c=1>=a?window.innerWidth*a:a,d=1>=b?window.innerHeight*b:b,this.w=c,this.h=d,this.canvas.width=this.w,this.canvas.height=this.h,this.cx=this.w/2,this.cy=this.h/2,this.tempCanvas.width=this.w,this.tempCanvas.height=this.h},Centi.prototype.clr=function(){this.clear()},Centi.prototype.clear=function(){if(null!=this.ctx){var a=this.ctx.globalCompositeOperation;this.ctx.globalCompositeOperation="source-over",this.ctx.clearRect(0,0,this.w,this.h),this.ctx.fillStyle="rgba("+this.bgcolor.r+","+this.bgcolor.g+","+this.bgcolor.b+","+this.bgcolor.a/255+")",this.ctx.fillRect(0,0,this.w,this.h),this.ctx.globalCompositeOperation=a,this.col(255)}},Centi.prototype.Obj=function(){return new Object},Centi.prototype.obj=function(){return new Object},Centi.prototype.rnd=function(){return this.rand.apply(this,arguments)},Centi.prototype.rand=function(){var a=arguments.length;return 1==a?Math.random()*arguments[0]:2==a?Math.random()*(arguments[1]-arguments[0])+arguments[0]:Math.random()},Centi.prototype.nz=function(){return this.noise.apply(this,arguments)},Centi.prototype.noise=function(){var a=arguments.length;return 1==a?perlin.perlin2(arguments[0],0):2==a?perlin.perlin2(arguments[0],arguments[1]):3==a?perlin.perlin3(arguments[0],arguments[1],arguments[2]):0},Centi.prototype.pixel=function(a,b,c){null!=this.ctx&&(c=void 0===c?!0:c,c?this.rect(Math.floor(a),Math.floor(b),1,1):this.rect(a,b,1,1))},Centi.prototype.tri=function(){null!=this.ctx&&(6==arguments.length?(this.beginShape(),this.moveTo(arguments[0],arguments[1]),this.lineTo(arguments[2],arguments[3]),this.lineTo(arguments[4],arguments[5]),this.lineTo(arguments[0],arguments[1]),this.endShape()):3==arguments.length&&(this.beginShape(),this.moveTo(arguments[0].x,arguments[0].y),this.lineTo(arguments[1].x,arguments[1].y),this.lineTo(arguments[2].x,arguments[2].y),this.lineTo(arguments[0].x,arguments[0].y),this.endShape()))},Centi.prototype.rect=function(a,b,c,d){null!=this.ctx&&(this.bFill?this.ctx.fillRect(a,b,c,d):this.ctx.strokeRect(a,b,c,d))},Centi.prototype.oval=function(a,b,c,d){if(null!=this.ctx)if(d=d||-1,-1==d)this.ctx.beginPath(),this.ctx.arc(a,b,c,0,2*Math.PI,!0),this.bFill?this.ctx.fill():this.ctx.stroke();else{3>d&&(d=3);var e=Math.PI2/d;this.ctx.beginPath();for(var f=parseInt(d),g=0;d>g;g++){var h=e*g,i=e*(g+1);g>f-1&&(i=0);var j=Math.cos(h)*c+a,k=Math.sin(h)*c+b,l=Math.cos(i)*c+a,m=Math.sin(i)*c+b;this.lineTo(j,k),this.lineTo(l,m)}this.bFill?this.ctx.fill():this.ctx.stroke()}},Centi.prototype.ln=function(a,b,c,d){this.line(a,b,c,d)},Centi.prototype.line=function(a,b,c,d){null!=this.ctx&&(this.ctx.beginPath(),this.ctx.moveTo(a,b),this.ctx.lineTo(c,d),this.ctx.stroke())},Centi.prototype.curve=function(){null!=this.ctx&&(8==arguments.length?(this.beginShape(),this.moveTo(arguments[0],arguments[1]),this.curveTo(arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7]),this.endShape()):1==arguments.length&&arguments[0].length&&8==arguments[0].length&&this.curve(arguments[0][0],arguments[0][1],arguments[0][2],arguments[0][3],arguments[0][4],arguments[0][5],arguments[0][6],arguments[0][7]))},Centi.prototype.moveTo=function(a,b){null!=this.ctx&&this.ctx.moveTo(a,b)},Centi.prototype.lineTo=function(a,b){null!=this.ctx&&this.ctx.lineTo(a,b)},Centi.prototype.curveTo=function(){null!=this.ctx&&(6==arguments.length?this.ctx.bezierCurveTo(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]):1==arguments.length&&arguments[0].length&&6==arguments[0].length&&this.ctx.bezierCurveTo(arguments[0][0],arguments[0][1],arguments[0][2],arguments[0][3],arguments[0][4],arguments[0][5]))},Centi.prototype.lines=function(a,b){b=b||!1;var c=a.length;if(c>=2){var d=a,e=d[0],f=e.hasOwnProperty("x")&&e.hasOwnProperty("y");if(f){for(var g,h=0;c>h;h++)g=d[h],0==h?this.moveTo(g.x,g.y):this.lineTo(g.x,g.y);b&&(g=d[0],this.lineTo(g.x,g.y))}else{for(var i,j,h=0;c>h;h+=2)i=d[h],j=d[h+1],0==h?this.moveTo(i,j):this.lineTo(i,j);b&&(i=d[0],j=d[1],this.lineTo(i,j))}}},Centi.prototype.text=function(){if(null!=this.ctx){var a=arguments.length;1==a?this.bFill?this.ctx.fillText(arguments[0],0,0):this.ctx.strokeText(arguments[0],0,0):2==a?this.bFill?this.ctx.fillText(arguments[0],arguments[1],arguments[2]):this.ctx.strokeText(arguments[0],arguments[1],arguments[2]):3==a?this.bFill?this.ctx.fillText(arguments[0],arguments[1],arguments[2]):this.ctx.strokeText(arguments[0],arguments[1],arguments[2]):4==a&&(this.bFill?this.ctx.fillText(arguments[0],arguments[1],arguments[2],arguments[3]):this.ctx.strokeText(arguments[0],arguments[1],arguments[2],arguments[3]))}},Centi.prototype.font=function(){var a=arguments.length;1==a?this.ctx.font=arguments[0]instanceof String?"12px "+arguments[0]:arguments[0]+"px 'Helvetica'":2==a?this.ctx.font=arguments[1]+"px "+arguments[0]:3==a?this.ctx.font=(arguments[2]?"bold ":"")+arguments[1]+"px "+arguments[0]:4==a&&(this.ctx.font=(arguments[3]?"italic ":"")+(arguments[2]?"bold ":"")+arguments[1]+"px "+arguments[0])},Centi.prototype.boundingBox=function(a){var b=a.length,c=this.Vec2(1/0,1/0),d=this.Vec2(-1/0,-1/0);if(b>0){var e=a,f=e[0],g=f.hasOwnProperty("x")&&f.hasOwnProperty("y");if(g)for(var h,i=0;b>i;i++)h=e[i],h.x<c.x&&(c.x=h.x),h.y<c.y&&(c.y=h.y),h.x>d.x&&(d.x=h.x),h.y>d.y&&(d.y=h.y);else for(var j,k,i=0;b>i;i+=2)j=e[i],k=e[i+1],j<c.x&&(c.x=j),k<c.y&&(c.y=k),j>d.x&&(d.x=j),k>d.y&&(d.y=k);return this.Rectangle(c.x,c.y,d.x-c.x,d.y-c.y)}return this.Rectangle(0,0,0,0)},Centi.prototype.strk2fill=function(a,b,c){if(!a)return[];var d=a.length;if(0==d)return[];b=b||1,c=parseInt(c)||1,0>=c&&(c=1);for(var e,f=[],g=[],h=[],i=0;d>i;i+=c)if(e){var j=a[i],k=this.Vec2(e.y-j.y,j.x-e.x);k=k.normalized();var l=this.Vec2(j.x+k.x*b/2,j.y+k.y*b/2),m=this.Vec2(j.x-k.x*b/2,j.y-k.y*b/2),n=this.Vec2(e.x+k.x*b/2,e.y+k.y*b/2),o=this.Vec2(e.x-k.x*b/2,e.y-k.y*b/2);if(i==c)g.push(n),h.unshift(o);else if(i>c){var p=g[g.length-1],q=h[0];g[g.length-1].x=(p.x+n.x)/2,g[g.length-1].y=(p.y+n.y)/2,h[0].x=(q.x+o.x)/2,h[0].y=(q.y+o.y)/2}g.push(l),h.unshift(m),e=j}else e=a[i];return d=g.length,f=f.concat(g),f=f.concat(h)},Centi.prototype.xys2pts=function(a){var b=a||[];if(0==b.length)return[];var c=b[0],d=c.hasOwnProperty("x")&&c.hasOwnProperty("y");if(d)return b;for(var e=[],f=b.length,g=0;f>g;g+=2)e.push(this.Vec2(b[g],b[g+1]));return e},Centi.prototype.beginShape=function(){null!=this.ctx&&this.ctx.beginPath()},Centi.prototype.endShape=function(){null!=this.ctx&&(this.bFill?this.ctx.fill():this.ctx.stroke())},Centi.prototype.me=function(){this.drawMe.apply(this,arguments)},Centi.prototype.drawMe=function(){if(null!=this.ctx){var a=arguments.length;2==a?this.ctx.drawImage(this.canvas,arguments[0],arguments[1]):4==a?this.ctx.drawImage(this.canvas,arguments[0],arguments[1],arguments[2],arguments[3]):8==a&&this.ctx.drawImage(this.canvas,arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7])}},Centi.prototype.lw=function(a){this.lineWidth(a)},Centi.prototype.lineWidth=function(a){null!=this.ctx&&(this.ctx.lineWidth=a)},Centi.prototype.lj=function(a){this.lineJoin(a)},Centi.prototype.lineJoin=function(a){null!=this.ctx&&(0==a?this.ctx.lineJoin="bevel":1==a?this.ctx.lineJoin="round":2==a&&(this.ctx.lineJoin="miter"))},Centi.prototype.lc=function(a){this.lineCap(a)},Centi.prototype.lineCap=function(a){null!=this.ctx&&(0==a?this.ctx.lineCap="butt":1==a?this.ctx.lineCap="round":2==a&&(this.ctx.lineCap="square"))},Centi.prototype.bm=function(a){this.blendMode(a)},Centi.prototype.blendMode=function(a){if(null!=this.ctx){var b="source-over",c=["source-over","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"];a<c.length&&(b=c[a],this.ctx.globalCompositeOperation=b)}},Centi.prototype.hcol=function(a){a>>24>0?this.col(255&a>>16,255&a>>8,255&a,255&a>>24):this.col(255&a>>16,255&a>>8,255&a)},Centi.prototype.col=function(){var a=arguments.length,b="rgb(0,0,0)";1==a?(this.drawcolor.r=arguments[0],this.drawcolor.g=arguments[0],this.drawcolor.b=arguments[0],this.drawcolor.a=255,b="rgb("+parseInt(arguments[0])+","+parseInt(arguments[0])+","+parseInt(arguments[0])+")"):2==a?(this.drawcolor.r=arguments[0],this.drawcolor.g=arguments[0],this.drawcolor.b=arguments[0],this.drawcolor.a=arguments[1],b="rgba("+parseInt(arguments[0])+","+parseInt(arguments[0])+","+parseInt(arguments[0])+","+parseInt(arguments[1])/255+")"):3==a?(this.drawcolor.r=arguments[0],this.drawcolor.g=arguments[1],this.drawcolor.b=arguments[2],this.drawcolor.a=255,b="rgb("+parseInt(arguments[0])+","+parseInt(arguments[1])+","+parseInt(arguments[2])+")"):4==a&&(this.drawcolor.r=arguments[0],this.drawcolor.g=arguments[1],this.drawcolor.b=arguments[2],this.drawcolor.a=arguments[3],b="rgba("+parseInt(arguments[0])+","+parseInt(arguments[1])+","+parseInt(arguments[2])+","+parseInt(arguments[3])/255+")"),this.ctx.fillStyle=b,this.ctx.strokeStyle=b,this.gradient=null},Centi.prototype.fill=function(){this.bFill=!0,this.gradient=null},Centi.prototype.strk=function(){this.stroke()},Centi.prototype.stroke=function(){this.bFill=!1,this.gradient=null},Centi.prototype.grad=function(a,b,c,d){this.bFill=!0,this.ctx&&(this.gradient=this.ctx.createLinearGradient(a,b,c,d),this.ctx.fillStyle=this.gradient)},Centi.prototype.gradR=function(a,b,c,d,e,f){this.bFill=!0,this.ctx&&(this.gradient=this.ctx.createRadialGradient(a,b,c,d,e,f),this.ctx.fillStyle=this.gradient)},Centi.prototype.gradColor=function(a){if(this.gradient){a=this.minmax(a,0,1);var f=[];if(arguments.length>1)for(var g=1;g<arguments.length;g++)f.push(arguments[g]);this.gradient.addColorStop(a,this.colorString.apply(this,f))}},Centi.prototype.gradHex=function(a,b){if(this.gradient){a=this.minmax(a,0,1);var c=[];b=void 0===b?16777215:b,c=b>>24>0?[255&b>>16,255&b>>8,255&b,255&b>>24]:[255&b>>16,255&b>>8,255&b,255],this.gradient.addColorStop(a,this.colorString.apply(this,c))}},Centi.prototype.colorString=function(){var a=arguments.length,b="rgb(0,0,0)";return 1==a?b="rgb("+parseInt(arguments[0])+","+parseInt(arguments[0])+","+parseInt(arguments[0])+")":2==a?b="rgba("+parseInt(arguments[0])+","+parseInt(arguments[0])+","+parseInt(arguments[0])+","+parseInt(arguments[1])/255+")":3==a?b="rgb("+parseInt(arguments[0])+","+parseInt(arguments[1])+","+parseInt(arguments[2])+")":4==a&&(b="rgba("+parseInt(arguments[0])+","+parseInt(arguments[1])+","+parseInt(arguments[2])+","+parseInt(arguments[3])/255+")"),b},Centi.prototype.push=function(){null!=this.ctx&&this.ctx.save()},Centi.prototype.pop=function(){null!=this.ctx&&this.ctx.restore()},Centi.prototype.rotate=function(a){null!=this.ctx&&this.ctx.rotate(a)},Centi.prototype.scale=function(a,b){null!=this.ctx&&this.ctx.scale(a,b)},Centi.prototype.translate=function(a,b){null!=this.ctx&&this.ctx.translate(a,b)},Centi.prototype.transform=function(a,b,c,d,e,f){null!=this.ctx&&this.ctx.transform(a,b,c,d,e,f)},Centi.prototype.drawFFT=function(a,b,c,d,e,f){var g=f||2,h=e||9;1>h&&(h=1);for(var i=this.fft.length,j=c/i,k=d/255,l=0;i>l;l+=h)this.rect(a+l*j,b+d,g,-this.fft[l]*k)},Centi.prototype.drawWave=function(a,b,c,d,e){var f=e||9;1>f&&(f=1);var g=this.wave.length,h=c/(g-1),i=d/2;this.beginShape();for(var j=0;g>j;j+=f)this.lineTo(a+j*h,b+i+this.wave[j]*i);this.endShape()},Centi.prototype.interp=function(a,b,c){return b+(a-b)*c},Centi.prototype.dist=function(){var a=arguments.length;if(4==a){var b=arguments[0]-arguments[2],c=arguments[1]-arguments[3];return Math.sqrt(b*b+c*c)}return 2==a&&arguments[0].hasOwnProperty("x")&&arguments[0].hasOwnProperty("y")&&arguments[1].hasOwnProperty("x")&&arguments[1].hasOwnProperty("y")?this.dist(arguments[0].x,arguments[0].y,arguments[1].x,arguments[1].y):void 0},Centi.prototype.wrap=function(a,b,c){var d=c-b;if(d>0){for(;b>a;)a+=d;for(;a>c;)a-=d;return a}return a},Centi.prototype.minmax=function(a,b,c){return this.minMax(a,b,c)},Centi.prototype.minMax=function(a,b,c){return Math.min(c,Math.max(a,b))},Centi.prototype.map=function(a,b,c,d,e){return(a-b)/(c-b)*(e-d)+d},Centi.prototype.zmap=function(a,b,c,d,e){return this.minMax(this.map(a,b,c,d,e),d,e)},Centi.prototype.avg=function(a){if(a&&a.length>0){for(var b=a.length,c=0,d=0;b>d;d++)c+=a[d];return c/b}return 0},Centi.prototype.cent=function(){var a=arguments.length;if(1==a&&arguments[0].length>1){a=arguments[0].length;for(var b={x:0,y:0},c=0,d=0;a>d;d++){var e=arguments[0][d],f=arguments[0][(d+1)%a];b.x+=(e.x+f.x)*(e.x*f.y-f.x*e.y),b.y+=(e.y+f.y)*(e.x*f.y-f.x*e.y),c+=e.x*f.y-f.x*e.y}return c/=2,b.x=b.x/(6*c),b.y=b.y/(6*c),b}return{x:0,y:0}},Centi.prototype.curves=function(){var a=arguments.length;if(9==a)return this.getPointsOnCurve(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8]);if(2==a){if(arguments[1].length&&8==arguments[1].length)return this.getPointsOnCurve(arguments[0],arguments[1][0],arguments[1][1],arguments[1][2],arguments[1][3],arguments[1][4],arguments[1][5],arguments[1][6],arguments[1][7])}else if(1==a&&arguments[0].length&&9==arguments[0].length)return this.getPointsOnCurve(arguments[0][0],arguments[0][1],arguments[0][2],arguments[0][3],arguments[0][4],arguments[0][5],arguments[0][6],arguments[0][7],arguments[0][8])},Centi.prototype.getPointsOnCurve=function(a,b,c,d,e,f,g,h,i){2>a&&(a=2);for(var j=[],k=0;a>k;k++){var l=k/(a-1);j.push(this.getPointOnCubicBezier(l,b,d,f,h)),j.push(this.getPointOnCubicBezier(l,c,e,g,i))}return j},Centi.prototype.getPointOnCubicBezier=function(a,b,c,d,e){var f=1-a;return f*f*f*b+3*f*f*a*c+3*f*a*a*d+a*a*a*e},Centi.prototype.radToDeg=function(a){return this.r2d(a)},Centi.prototype.r2d=function(a){return 180*a/Math.PI},Centi.prototype.degToRad=function(a){return this.d2r(a)},Centi.prototype.d2r=function(a){return a*Math.PI/180},Centi.prototype.tree=function(a){function b(a,b){return Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2)}this.kdtree=new kdTree(a,b,["x","y"])},Centi.prototype.nears=function(a,b,c){return this.kdtree.nearest(a,b,c)},Centi.prototype.bpm=function(a,b){this.tempo.bpm=a?a:120,this.tempo.divide=b?b:4,this.tempo.sec=4*(60/this.tempo.bpm)/this.tempo.divide,this.tempo.preSec=this.time},Centi.prototype.noteToFreq=function(a){return this.n2f(a)},Centi.prototype.n2f=function(a){return 440*Math.pow(2,(a-69)/12)},Centi.prototype.loop=function(a,b,c){for(var d=a,f=b-a>0?1:-1,g=1==f?b-a:-(b-a);g>=0;)c(d),d+=f,g--},Centi.prototype.sortNum=function(a){a.sort(function(a,b){return b>a?-1:a>b?1:0})},Centi.prototype.reverse=function(a){a.reverse()},Centi.prototype.fold=function(a){if(a.reduce)return a.reduce(function(a,b){return a+b});for(var b=0,c=0;c<a.length;c++)b+=a[c];return b},Centi.prototype.remove=function(a,b){for(var c=[],d=a.length,e=0;d>e;e++)b(a[e])||c.push(a[e]);return c},Centi.prototype.clip=function(a,b){return a.length<b?a:a.slice(a.length-b)},Centi.prototype.Vec2=function(a,b){return new Centi.Vec2(a,b)},Centi.prototype.vec2=function(a,b){return new Centi.Vec2(a,b)},Centi.prototype.Rectangle=function(a,b,c,d){return new Centi.Rectangle(a,b,c,d)},Centi.Numerical=new function(){return{EPSILON:1e-11,isZero:function(a){return Math.abs(a)<=this.EPSILON}}},Centi.Vec2=function(a,b){this.x=a||0,this.y=b||0},Centi.Vec2.prototype.set=function(a,b){return this.x=a,this.y=b,this},Centi.Vec2.prototype.clone=function(){return new Centi.Vec2(this.x,this.y)},Centi.Vec2.prototype.equals=function(){return this===_vec2||_vec2&&(this.x===_vec2.x&&this.y===_vec2.y||Array.isArray(_vec2)&&this.x===_vec2[0]&&this.y===_vec2[1])||!1},Centi.Vec2.prototype.normalized=function(){var a=Math.sqrt(this.x*this.x+this.y*this.y);return new Centi.Vec2(this.x/a,this.y/a)},Centi.Vec2.prototype.normalize=function(){var a=Math.sqrt(this.x*this.x+this.y*this.y);this.x=this.x/a,this.y=this.y/a},Centi.Vec2.prototype.dist=function(){return this.distance.apply(this,arguments)},Centi.Vec2.prototype.distance=function(){var a=arguments.length;if(1==a){var b=arguments[0];if(b){var c=this.x-b.x,d=this.y-b.y,e=Math.sqrt(c*c+d*d);return e}}else{if(0==a){var e=Math.sqrt(this.x*this.x+this.y*this.y);return e}if(2==a){var c=this.x-arguments[0],d=this.y-arguments[1],e=Math.sqrt(c*c+d*d);return e}}},Centi.Vec2.prototype.dot=function(a){return this.x*a.x+this.y+a.y},Centi.Vec2.prototype.cross=function(a){return this.x*a.x-this.y+a.y},Centi.Vec2.prototype.rotation=function(){if(arguments.length){var a=arguments[0],b=this.len()*a.len();if(Numerical.isZero(b))return 0/0;var c=this.dot(a)/b;return Math.acos(-1>c?-1:c>1?1:c)}return this.isZero()?this._rotation||0:this._rotation=Math.atan2(this.y,this.x)},Centi.Vec2.prototype.setRotation=function(a){if(this._rotation=a,!this.isZero()){var b=this.len();this.set(Math.cos(a)*b,Math.sin(a)*b)}},Centi.Vec2.prototype.len=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},Centi.Vec2.prototype.setLen=function(a){if(this.isZero()){var b=this._rotation||0;this.set(Math.cos(b)*a,Math.sin(b)*a)}else{var c=a/this.len();Centi.Numerical.isZero(c)&&this.rotation(),this.set(this.x*c,this.y*c)}},Centi.Vec2.prototype.rotate=function(a,b){if(0===a)return this.clone();var c=b?this.subtract(b):this,d=Math.sin(a),e=Math.cos(a);return c=new Centi.Vec2(c.x*e-c.y*d,c.x*d+c.y*e),b?c.add(b):c},Centi.Vec2.prototype.add=function(a){return new Centi.Vec2(this.x+a.x,this.y+a.y)},Centi.Vec2.prototype.subtract=function(a){return new Centi.Vec2(this.x-a.x,this.y-a.y)},Centi.Vec2.prototype.multiply=function(a){return new Centi.Vec2(this.x*a.x,this.y*a.y)},Centi.Vec2.prototype.divide=function(a){return new Centi.Vec2(this.x/a.x,this.y/a.y)},Centi.Vec2.prototype.modulo=function(a){return new Centi.Vec2(this.x%a.x,this.y%a.y)},Centi.Vec2.prototype.negate=function(){return new Centi.Vec2(-this.x,-this.y)},Centi.Vec2.prototype.isZero=function(){return Centi.Numerical.isZero(this.x)&&Centi.Numerical.isZero(this.y)},Centi.Rectangle=function(a,b,c,d){this.x=a||0,this.y=b||0,this.w=this.width=c||0,this.h=this.height=d||0,this.r=this.right=this.x+this.w,this.b=this.bottom=this.y+this.h},Centi.prototype.now=function(){return(new Date).getTime()/1e3},Centi.prototype.grid=function(a,b,c,d){var g,h,e=a/c,f=b/d,i=[];for(g=0;c>g;g++)for(h=0;d>h;h++)i.push({ix:g,iy:h,x:g*e,y:h*f,w:e,h:f});return i},Centi.prototype.tween=function(a){var b=new TWEEN.Tween(a);return b},Centi.prototype.new=function(a,b){function c(){a.apply(this,b)}return c.prototype=a.prototype,new c},Centi.prototype.seg=function(a,b,c,d,e){var f=[1,2,11,19,20,29,37],g=[119,36,93,109,46,107,123,37,127,111];a>9&&(a=9);for(var h=g[a],i=0;7>i;i++){if(1&h){var j=7&f[i],k=f[i]>>3;this.line(b+d*(1&j),c+.5*e*(j>>1),b+d*(1&k),c+.5*e*(k>>1))}h>>=1}},Centi.prototype.shrink=function(a,b){a=a||1,a=1>a?1:a,b=b||a,b=1>b?1:b;var c=this.w/a,d=this.h/b;this.tempCtx.clearRect(0,0,this.w,this.h),this.tempCtx.drawImage(this.canvas,0,0,this.w,this.h,0,0,c,d),this.ctx.drawImage(this.tempCanvas,0,0,c,d,0,0,this.w,this.h)},Centi.prototype.mosaic=function(a,b){a=a||1,a=1>a?1:a,b=b||a,b=1>b?1:b;var c=Math.floor(this.w/a),d=Math.floor(this.h/b);this.tempCtx.clearRect(0,0,this.w,this.h),this.tempCtx.drawImage(this.canvas,0,0,this.w,this.h,0,0,c,d);
var e=this.tempCtx.getImageData(0,0,c,d).data;a=this.w/c,b=this.h/d;for(var f=0;d>f;f+=1)for(var g=0;c>g;g+=1){var h=4*(g+f*c);this.ctx.fillStyle="rgb("+e[h]+", "+e[h+1]+", "+e[h+2]+")",this.ctx.fillRect(g*a,f*b,a,b)}},Centi.prototype.glitch=function(a,b,c,d){a=a||0,b=b||0,c=c||0,d=d||0;var e=this,f={amount:a,seed:b,iterations:c,quality:d};glitch(this.ctx.getImageData(0,0,this.w,this.h),f,function(a){e.ctx.putImageData(a,0,0)})},Centi.prototype.crash=function(a){var b,c,f,j,k,n,o,p,d=this.w,e=this.h,g=a||6,h=4*Math.floor(this.rand(2*-g,2*g))*d*+Math.floor(this.rand(-g,g)),i=g*g/100*d,l=this.tempCanvas,m=this.tempCtx;for(l.width=d,l.height=e,m.clearRect(0,0,this.w,this.h),m.drawImage(this.canvas,0,0,d,e),n=m.getImageData(0,0,d,e).data,f=0;g>f;f++)c=Math.floor(this.rand(0,e)),k=Math.min(Math.floor(this.rand(1,e/4)),e-c),b=Math.floor(this.rand(1,i)),j=d-b,m.drawImage(this.canvas,0,c,j,k,b,c,j,k),m.drawImage(this.canvas,j,c,b,k,0,c,b,k);for(o=m.getImageData(0,0,d,e),p=o.data,f=Math.floor(this.rand(0,3)),g=n.length;g>f;f+=4)p[f+h]=n[f];for(f=0;g>f;f++)p[f++]*=2,p[f++]*=2,p[f++]*=2;for(m.putImageData(o,0,0),m.fillStyle="rgb(0,0,0)",f=0;e>f;f+=2)m.fillRect(0,f,d,1);this.ctx.drawImage(l,0,0)};var CT_FUNCS=Object.getOwnPropertyNames(Centi.prototype);

!function(a){a.prototype.Matrix=function(){return this.new(a.Matrix,arguments)},a.Matrix=function(){var a=arguments.length,b=!0;if(6===a?this.set.apply(this,arguments):1===a?arg instanceof Matrix?this.set(arg._a,arg._c,arg._b,arg._d,arg._tx,arg._ty):Array.isArray(arg)?this.set.apply(this,arg):b=!1:0===a?this.reset():b=!1,!b)throw new Error("Unsupported matrix parameters")},a.Matrix.prototype.set=function(a,b,c,d,e,f,g){return this._a=a,this._c=b,this._b=c,this._d=d,this._tx=e,this._ty=f,g||this._changed(),this},a.Matrix.prototype._changed=function(){var a=this._owner;a&&(a._applyMatrix?a.transform(null,!0):a._changed(9))},a.Matrix.prototype.clone=function(){return new a.Matrix(this._a,this._c,this._b,this._d,this._tx,this._ty)},a.Matrix.prototype.equals=function(a){return a===this||a&&this._a===a._a&&this._b===a._b&&this._c===a._c&&this._d===a._d&&this._tx===a._tx&&this._ty===a._ty||!1},a.Matrix.prototype.reset=function(a){return this._a=this._d=1,this._c=this._b=this._tx=this._ty=0,a||this._changed(),this},a.Matrix.prototype.apply=function(){var a=this._owner;return a?(a.transform(null,!0),this.isIdentity()):!1},a.Matrix.prototype.translate=function(a,b){return this._tx+=a*this._a+b*this._b,this._ty+=a*this._c+b*this._d,this._changed(),this},a.Matrix.prototype.scale=function(b,c,d,e){var f=new a.Vec2(b,c);return 4==arguments.length&&this.translate(d,e),this._a*=f.x,this._c*=f.x,this._b*=f.y,this._d*=f.y,4==arguments.length&&this.translate(-d,-e),this._changed(),this},a.Matrix.prototype.rotate=function(a,b,c){a*=Math.PI/180,b=b||0,c=c||0;var d=Math.cos(a),e=Math.sin(a),f=b-b*d+c*e,g=c-b*e-c*d,h=this._a,i=this._b,j=this._c,k=this._d;return this._a=d*h+e*i,this._b=-e*h+d*i,this._c=d*j+e*k,this._d=-e*j+d*k,this._tx+=f*h+g*i,this._ty+=f*j+g*k,this._changed(),this},a.Matrix.prototype.shear=function(b,c,d,e){var f=new a.Vec2(b,c);4==arguments.length&&this.translate(d,e);var g=this._a,h=this._c;return this._a+=f.y*this._b,this._c+=f.y*this._d,this._b+=f.x*g,this._d+=f.x*h,4==arguments.length&&this.translate(-d,-e),this._changed(),this},a.Matrix.prototype.skew=function(b,c,d,e){var f=new a.Vec2(b,c),g=Math.PI/180,h=new a.Vec2(Math.tan(f.x*g),Math.tan(f.y*g));return this.shear(h.x,h.y,d,e)},a.Matrix.prototype.concatenate=function(a){var b=this._a,c=this._b,d=this._c,e=this._d,f=a._a,g=a._b,h=a._c,i=a._d,j=a._tx,k=a._ty;return this._a=f*b+h*c,this._b=g*b+i*c,this._c=f*d+h*e,this._d=g*d+i*e,this._tx+=j*b+k*c,this._ty+=j*d+k*e,this._changed(),this},a.Matrix.prototype.preConcatenate=function(a){var b=this._a,c=this._b,d=this._c,e=this._d,f=this._tx,g=this._ty,h=a._a,i=a._b,j=a._c,k=a._d,l=a._tx,m=a._ty;return this._a=h*b+i*d,this._b=h*c+i*e,this._c=j*b+k*d,this._d=j*c+k*e,this._tx=h*f+i*g+l,this._ty=j*f+k*g+m,this._changed(),this},a.Matrix.prototype.chain=function(b){var c=this._a,d=this._b,e=this._c,f=this._d,g=this._tx,h=this._ty,i=b._a,j=b._b,k=b._c,l=b._d,m=b._tx,n=b._ty;return new a.Matrix(i*c+k*d,i*e+k*f,j*c+l*d,j*e+l*f,g+m*c+n*d,h+m*e+n*f)},a.Matrix.prototype.isIdentity=function(){return 1===this._a&&0===this._c&&0===this._b&&1===this._d&&0===this._tx&&0===this._ty},a.Matrix.prototype.orNullIfIdentity=function(){return this.isIdentity()?null:this},a.Matrix.prototype.isInvertible=function(){return!!this._getDeterminant()},a.Matrix.prototype.isSingular=function(){return!this._getDeterminant()},a.Matrix.prototype.transform=function(a,b,c){return arguments.length<3?this._transformPoint(Point.read(arguments)):this._transformCoordinates(a,b,c)},a.Matrix.prototype._transformPoint=function(b,c,d){var e=b.x,f=b.y;return c||(c=new a.Vec2),c.set(e*this._a+f*this._b+this._tx,e*this._c+f*this._d+this._ty,d)},a.Matrix.prototype._transformCoordinates=function(a,b,c){for(var d=0,e=0,f=2*c;f>d;){var g=a[d++],h=a[d++];b[e++]=g*this._a+h*this._b+this._tx,b[e++]=g*this._c+h*this._d+this._ty}return b},a.Matrix.prototype._transformCorners=function(a){var b=a.x,c=a.y,d=b+a.width,e=c+a.height,f=[b,c,d,c,d,e,b,e];return this._transformCoordinates(f,f,4)},a.Matrix.prototype._transformBounds=function(b,c,d){for(var e=this._transformCorners(b),f=e.slice(0,2),g=e.slice(),h=2;8>h;h++){var i=e[h],j=1&h;i<f[j]?f[j]=i:i>g[j]&&(g[j]=i)}return c||(c=new a.Rectangle),c.set(f[0],f[1],g[0]-f[0],g[1]-f[1],d)},a.Matrix.prototype.inverseTransform=function(){return this._inverseTransform(Point.read(arguments))},a.Matrix.prototype._getDeterminant=function(){var a=this._a*this._d-this._b*this._c;return isFinite(a)&&!Numerical.isZero(a)&&isFinite(this._tx)&&isFinite(this._ty)?a:null},a.Matrix.prototype._inverseTransform=function(a,b,c){var d=this._getDeterminant();if(!d)return null;var e=a.x-this._tx,f=a.y-this._ty;return b||(b=new Point),b.set((e*this._d-f*this._b)/d,(f*this._a-e*this._c)/d,c)},a.Matrix.prototype.decompose=function(){var b=this._a,c=this._b,d=this._c,e=this._d;if(Numerical.isZero(b*e-c*d))return null;var f=Math.sqrt(b*b+c*c);b/=f,c/=f;var g=b*d+c*e;d-=b*g,e-=c*g;var h=Math.sqrt(d*d+e*e);return d/=h,e/=h,g/=h,c*d>b*e&&(b=-b,c=-c,g=-g,f=-f),{scaling:new a.Vec2(f,h),rotation:180*-Math.atan2(c,b)/Math.PI,shearing:g}},a.Matrix.prototype.getValues=function(){return[this._a,this._c,this._b,this._d,this._tx,this._ty]},a.Matrix.prototype.getTranslation=function(){return new a.Vec2(this._tx,this._ty)},a.Matrix.prototype.getScaling=function(){return(this.decompose()||{}).scaling},a.Matrix.prototype.getRotation=function(){return(this.decompose()||{}).rotation},a.Matrix.prototype.inverted=function(){var b=this._getDeterminant();return b&&new a.Matrix(this._d/b,-this._c/b,-this._b/b,this._a/b,(this._b*this._ty-this._d*this._tx)/b,(this._c*this._tx-this._a*this._ty)/b)},a.Matrix.prototype.shiftless=function(){return new a.Matrix(this._a,this._c,this._b,this._d,0,0)},a.Matrix.prototype.applyToContext=function(a){a.transform(this._a,this._c,this._b,this._d,this._tx,this._ty)}}(Centi);
